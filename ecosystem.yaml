apps:
  - name: api
    script: api/index.ts
    interpreter: node
    interpreter_args:
      - -r
      - ./ts-hook.js
      - -r
      - tsconfig-paths/register
      - -r
      - dotenv/config
    exec_mode: fork
    instances: 1
    restart_delay: 10000
    wait_ready: true
    env:
      NODE_ENV: development
    env_production:
      NODE_ENV: production
    log_file: logs/api.log
    watch:
      - ts-hook.js
    time: true
    max_restarts: 2
    merge_logs: true
  - name: next-dev
    script: next-hook.ts
    interpreter: node
    interpreter_args:
      - -r
      - ./ts-hook.js
    watch:
      - next-hook.ts
      - ts-hook.js
    exec_mode: fork
    instances: 1
    log_file: logs/client.log
    time: true
    autorestart: false
    wait_ready: true
    env:
      NODE_ENV: development
    merge_logs: true
  - name: next-prod
    script: next-hook.ts
    interpreter: node
    interpreter_args:
      - -r
      - ./ts-hook.js
    watch:
      - next-hook.ts
      - ts-hook.js
    exec_mode: cluster
    instances: 2
    log_file: logs/client.log
    time: true
    autorestart: false
    wait_ready: true
    env:
      NODE_ENV: production
    merge_logs: true
  - name: worker
    script: worker.ts
    interpreter: node
    interpreter_args:
      - -r
      - ./ts-hook.js
    log_file: logs/worker.log
    time: true
    watch:
      - worker.ts
      - ts-hook.js
    env:
      NODE_ENV: development
    env_production:
      NODE_ENV: production
    merge_logs: true
